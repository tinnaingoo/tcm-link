<!DOCTYPE html>
<html>
<head>
    <title>Blog Post</title>
    <script src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>
    <script>
        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyBIC4d0hxgkz0D2czjoBwEnq2vvKoRg35Q',
                clientId: '758794962809-b180fp84efb3qedhvgfe67nas112g6su.apps.googleusercontent.com',
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/blogger/v3/rest'],
                scope: 'https://www.googleapis.com/auth/blogger'
            }).then(function () {
                // Handle the sign-in state.
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            }, function(error) {
                console.error('Error initializing auth:', error);
                document.getElementById('post-content').textContent = `Error initializing auth: ${error.error}`;
            });
        }
        
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                // User is signed in
                console.log("User signed in");
            } else {
                // User is not signed in
                console.log("User not signed in");
            }
        }

        function postComment() {
            const author = document.getElementById('comment-author').value;
            const content = document.getElementById('comment-content').value;
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('post');
            const apiKey = 'AIzaSyBIC4d0hxgkz0D2czjoBwEnq2vvKoRg35Q';
            const blogId = '8069277289488798331';

            gapi.auth2.getAuthInstance().signIn().then(() => {
                gapi.client.setApiKey(apiKey);
                gapi.client.load('https://content.googleapis.com/discovery/v1/apis/blogger/v3/rest').then(() => {
                    return gapi.client.blogger.comments.insert({
                        blogId: blogId,
                        postId: postId,
                        resource: {
                            content: content,
                            author: {
                                displayName: author
                            }
                        }
                    }).then(response => {
                        console.log('Comment posted:', response);
                        fetchComments(postId);
                    }, error => {
                        console.error('Error posting comment:', error);
                        document.getElementById('post-content').textContent = `Error posting comment: ${error.result.error.message}`;
                    });
                });
            }).catch(error => {
                console.error('Error signing in:', error);
                document.getElementById('post-content').textContent = `Error signing in: ${error.error}`;
            });
        }

        function fetchComments(postId) {
            const apiKey = 'AIzaSyBIC4d0hxgkz0D2czjoBwEnq2vvKoRg35Q';
            const blogId = '8069277289488798331';

            fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/${postId}/comments?key=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    const commentsContainer = document.getElementById('comments-container');
                    commentsContainer.innerHTML = '<h2>Comments</h2>';
                    if (data.items && data.items.length > 0) {
                        data.items.forEach(comment => {
                            const commentElement = document.createElement('div');
                            commentElement.classList.add('comment-box');
                            commentElement.innerHTML = `
                                <p><strong>${comment.author.displayName}:</strong> ${comment.content}</p>
                                <p><small>Posted on ${new Date(comment.published).toLocaleDateString()}</small></p>
                            `;
                            commentsContainer.appendChild(commentElement);
                        });
                    } else {
                        commentsContainer.innerHTML += '<p>No comments yet.</p>';
                    }
                })
                .catch(error => console.error('Error fetching comments:', error));
        }
    </script>
</head>
<body>
    <div id="post-content"></div>
    <div id="comments-container"></div>
    <div class="container-box-comment-form">
        <h2>Leave a Comment</h2>
        <input type="text" id="comment-author" placeholder="Your Name">
        <textarea id="comment-content" placeholder="Your Comment"></textarea>
        <button onclick="postComment()">Submit Comment</button>
    </div>
</body>
</html>
